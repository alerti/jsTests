<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Hobby Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Arial', sans-serif; }
        .card { margin: 10px; }
        .modal-body img { max-width: 100%; }
        .favorites { position: fixed; top: 10px; right: 10px; z-index: 1000; }
    </style>
</head>
<body>

<div class="container mt-4">
    <h1>Hobby Finder</h1>
    <div class="input-group mb-3">
        <input class="form-control" id="search" placeholder="Search hobbies..." type="text">
        <select class="form-select" id="category">
            <option value="">All Categories</option>
            <!-- Categories will be dynamically filled -->
        </select>
        <input class="form-control" id="quantity" min="1" type="number" value="10">
        <button class="btn btn-primary" onclick="loadHobbies()">Find Hobbies</button>
    </div>

    <div class="row" id="hobbies"></div>

    <div class="favorites">
        <button class="btn btn-warning" onclick="toggleFavorites()">Favorites</button>
        <div id="favoritesList" style="display:none;"></div>
    </div>
</div>

<div class="modal fade" id="hobbyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hobbyModalLabel"></h5>
                <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body" id="hobbyModalBody">
                <!-- Modal content will be added here -->
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let hobbies = [];
  const favorites = JSON.parse(localStorage.getItem('favorites')) || [];

  function loadCategories() {
    fetch('https://api.api-ninjas.com/v1/hobbies?category=', {
      headers: { 'X-Api-Key': 'YOUR_API_KEY' }
    })
      .then(response => response.json())
      .then(data => {
        const categories = [...new Set(data.map(hobby => hobby.category))];
        categories.forEach(category => {
          $('#category').append(new Option(category, category));
        });
      });
  }

  function loadHobbies() {
    const category = $('#category').val();
    const quantity = $('#quantity').val();
    fetch(`https://api.api-ninjas.com/v1/hobbies?category=${category}&limit=${quantity}`, {
      headers: { 'X-Api-Key': 'YOUR_API_KEY' }
    })
      .then(response => response.json())
      .then(data => {
        hobbies = data;
        displayHobbies(hobbies.filter(hobby =>
          hobby.hobby.toLowerCase().includes($('#search').val().toLowerCase())
        ));
      }).catch(error => console.error('Error:', error));
  }

  function displayHobbies(hobbyList) {
    $('#hobbies').html('');
    hobbyList.forEach(hobby => {
      const card = `
        <div class="col-md-4">
            <div class="card">
                <img src="" alt="${hobby.hobby}" class="card-img-top" onerror="this.onerror=null;this.src='default.jpg';">
                <div class="card-body">
                    <h5 class="card-title">${hobby.hobby}</h5>
                    <button class="btn btn-info" onclick="showDetails('${hobby.hobby}')">Details</button>
                    <button class="btn ${favorites.includes(hobby.hobby) ? 'btn-warning' : 'btn-outline-secondary'}" onclick="toggleFavorite('${hobby.hobby}')">â˜…</button>
                </div>
            </div>
        </div>`;
      $('#hobbies').append(card);
      fetchWikiImage(hobby.hobby);
    });
  }

  function fetchWikiImage(hobbyName) {
    fetch(`https://en.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(hobbyName)}&prop=pageimages&format=json&pithumbsize=100&origin=*`)
      .then(response => response.json())
      .then(data => {
        const pages = data.query.pages;
        const pageId = Object.keys(pages)[0];
        if (pages[pageId].thumbnail) {
          $(`.card-img-top[alt="${hobbyName}"]`).attr('src', pages[pageId].thumbnail.source);
        }
      });
  }

  function showDetails(hobbyName) {
    const hobby = hobbies.find(h => h.hobby === hobbyName);
    if (hobby) {
      $('#hobbyModalLabel').text(hobby.hobby);
      $('#hobbyModalBody').html(`<p>${hobby.description}</p><p>Category: ${hobby.category}</p>`);
      $('#hobbyModal').modal('show');
    }
  }

  function toggleFavorite(hobbyName) {
    const index = favorites.indexOf(hobbyName);
    if (index > -1) {
      favorites.splice(index, 1);
    } else {
      favorites.push(hobbyName);
    }
    localStorage.setItem('favorites', JSON.stringify(favorites));
    displayHobbies(hobbies); // Refresh buttons
    toggleFavorites(); // Update favorites display
  }

  function toggleFavorites() {
    const favList = $('#favoritesList');
    if (favList.css('display') === 'none') {
      favList.html(favorites.map(fav => `<div>${fav}</div>`).join(''));
      favList.show();
    } else {
      favList.hide();
    }
  }

  $(document).ready(function() {
    loadCategories();
    $('#search').on('keyup', loadHobbies);
  });
</script>

</body>
</html>