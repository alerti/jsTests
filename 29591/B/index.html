<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Market Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.css" rel="stylesheet">
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
        }
        body.dark-theme {
            --background-color: #121212;
            --text-color: #ffffff;
        }
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .charts, .news { display: flex; flex-wrap: wrap; justify-content: space-around; }
        .chart-container { width: 45%; margin: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Real-Time Stock Dashboard</h1>
    <button onclick="toggleTheme()">Toggle Theme</button>
    <div class="charts">
        <div class="chart-container"><canvas id="stockChart"></canvas></div>
        <div class="chart-container"><canvas id="indexChart"></canvas></div>
    </div>
    <div class="news">
        <h2>Latest News</h2>
        <div id="newsFeed"></div>
    </div>
    <button onclick="exportToCSV()">Export Data to CSV</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const finnhubAPIKey = 'YOUR_FINNHUB_API_KEY';
  const newsAPIKey = 'YOUR_NEWS_API_KEY';

  // Function to toggle theme
  function toggleTheme() {
    document.body.classList.toggle('dark-theme');
  }

  // Fetch stock data and update chart
  function updateStockData(symbol, chartId) {
    fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${finnhubAPIKey}`)
      .then(response => response.json())
      .then(data => {
        const ctx = document.getElementById(chartId).getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: [new Date().toLocaleTimeString()],
            datasets: [{
              label: symbol,
              data: [data.c],
              borderColor: 'rgb(75, 192, 192)',
              fill: false
            }]
          },
          options: { responsive: true }
        });
      });
  }

  // Fetch news
  function fetchNews() {
    fetch(`https://newsapi.org/v2/everything?q=stock+market&apiKey=${newsAPIKey}`)
      .then(response => response.json())
      .then(data => {
        let newsHtml = '';
        data.articles.forEach(article => {
          newsHtml += `<div><h3>${article.title}</h3><p>${article.description}</p></div>`;
        });
        document.getElementById('newsFeed').innerHTML = newsHtml;
      });
  }

  // Initial data fetch and chart setup
  updateStockData('AAPL', 'stockChart');
  updateStockData('^GSPC', 'indexChart'); // Example for S&P 500
  fetchNews();

  // Periodic updates (you might want to use WebSockets for better real-time updates)
  setInterval(() => {
    updateStockData('AAPL', 'stockChart');
    updateStockData('^GSPC', 'indexChart');
  }, 60000); // Update every minute

  // CSV Export function (basic implementation)
  function exportToCSV() {
    // This is a simplified version; you'd need to gather all data points
    const csvContent = "data:text/csv;charset=utf-8,"
      + "Time,Stock Price\n"
      + new Date().toLocaleTimeString() + "," + document.querySelector('#stockChart').chart.data.datasets[0].data[0];
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "stock_data.csv");
    document.body.appendChild(link); // Required for FF
    link.click();
  }
</script>
</body>
</html>