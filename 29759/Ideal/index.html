<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Daily Planner App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-..." referrerpolicy="no-referrer" rel="stylesheet" />
    <style>
        body.light-theme {
            background-color: #f8f9fa;
            color: #343a40;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light-theme .card {
            background-color: #ffffff;
            color: #343a40;
        }

        body.light-theme .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        body.light-theme .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        body.light-theme .btn-success {
            background-color: #198754;
            border-color: #198754;
        }

        body.light-theme .btn-info {
            background-color: #0dcaf0;
            border-color: #0dcaf0;
        }

        body.light-theme .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        body.dark-theme {
            background-color: #212529;
            color: #f8f9fa;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-theme .card {
            background-color: #343a40;
            color: #f8f9fa;
        }

        body.dark-theme .btn-primary {
            background-color: #0b5ed7;
            border-color: #0a58ca;
        }

        body.dark-theme .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        body.dark-theme .btn-success {
            background-color: #198754;
            border-color: #198754;
        }

        body.dark-theme .btn-info {
            background-color: #0dcaf0;
            border-color: #0dcaf0;
        }

        body.dark-theme .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        body.dark-theme .modal {
            color: #000000;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-img-top {
            height: 200px;
            object-fit: cover;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .card-title {
            margin-bottom: 0.5rem;
        }

        .card-text {
            color: inherit;
        }

        .btn-custom {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .modal-body img {
            width: 100%;
            border-radius: 10px;
        }

        .closeModalBtn {
            border: none;
            background: transparent;
            font-size: 1.5rem;
        }

        .closeModalBtn:hover {
            color: #dc3545;
        }

        button:focus, input:focus, select:focus, textarea:focus {
            outline: 2px dashed #0d6efd;
            outline-offset: 2px;
        }

        #calendar {
            max-width: 900px;
            margin: 0 auto;
        }

        .fc-toolbar-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .fc-daygrid-event {
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .card-img-top {
                height: 150px;
            }
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }

        .toast {
            min-width: 250px;
            background-color: #333;
            color: #fff;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 10px;
            opacity: 0.9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.5s, fadeOut 0.5s 2.5s;
        }

        .toast.success { background-color: #28a745; }
        .toast.error { background-color: #dc3545; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 0.9; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 0.9; }
            to { opacity: 0; }
        }

        .toast .close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            line-height: 1;
        }

        #searchBar {
            position: relative;
        }

        #searchBar::placeholder {
            color: #6c757d;
        }

        #searchBarIcon {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            color: #6c757d;
        }
    </style>
</head>
<body>
<div class="container my-5" id="app">
    <header class="d-flex justify-content-between align-items-center mb-5">
        <h1 class="display-4">Organizer</h1>
        <div class="d-flex align-items-center">
            <button aria-label="Toggle Theme" class="btn btn-secondary me-3" data-bs-placement="bottom" data-bs-toggle="tooltip" id="themeToggleBtn" title="Toggle Light/Dark Theme">
                <i class="fas fa-moon"></i>
            </button>
            <button aria-label="Export Data" class="btn btn-success me-3" id="exportBtn">
                <i class="fas fa-download"></i> Export
            </button>
            <input accept=".json, .csv" id="importInput" style="display:none;" type="file">
        </div>
    </header>
    <main>
        <div class="mb-4 position-relative">
            <i class="fas fa-search position-absolute top-50 start-0 translate-middle-y ms-3" id="searchBarIcon"></i>
            <input aria-label="Search" class="form-control ps-5" id="searchBar" placeholder="Search Tasks, Notes, Reminders, Events..." type="text">
        </div>
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Tasks</h2>
                    <button aria-label="Add Task" class="btn btn-primary" id="newTaskBtn"><i class="fas fa-plus"></i> Add Task</button>
                </div>
                <div class="mb-3">
                    <select aria-label="Filter Tasks by Category" class="form-select" id="taskCategoryFilter">
                        <option value="all">All Categories</option>
                        <option value="Work">Work</option>
                        <option value="Personal">Personal</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>
                <div class="row g-4" id="tasksList"></div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Notes</h2>
                    <button aria-label="Add Note" class="btn btn-primary" id="newNoteBtn"><i class="fas fa-plus"></i> Add Note</button>
                </div>
                <div class="mb-3">
                    <select aria-label="Filter Notes by Category" class="form-select" id="noteCategoryFilter">
                        <option value="all">All Categories</option>
                        <option value="Ideas">Ideas</option>
                        <option value="Meeting">Meeting</option>
                        <option value="Personal">Personal</option>
                    </select>
                </div>
                <div class="row g-4" id="notesList"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Reminders</h2>
                    <button aria-label="Add Reminder" class="btn btn-primary" id="newReminderBtn"><i class="fas fa-plus"></i> Add Reminder</button>
                </div>
                <div class="mb-3">
                    <select aria-label="Filter Reminders by Category" class="form-select" id="reminderCategoryFilter">
                        <option value="all">All Categories</option>
                        <option value="Health">Health</option>
                        <option value="Home">Home</option>
                        <option value="Work">Work</option>
                    </select>
                </div>
                <div class="row g-4" id="remindersList"></div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Events</h2>
                    <button aria-label="Add Event" class="btn btn-primary" id="newEventBtn"><i class="fas fa-plus"></i> Add Event</button>
                </div>
                <div class="mb-3">
                    <select aria-label="Filter Events by Category" class="form-select" id="eventCategoryFilter">
                        <option value="all">All Categories</option>
                        <option value="Work">Work</option>
                        <option value="Social">Social</option>
                        <option value="Personal">Personal</option>
                    </select>
                </div>
                <div class="row g-4" id="eventsList"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 mb-4">
                <h2>Calendar</h2>
                <div id='calendar'></div>
            </div>
        </div>
    </main>
</div>

<div class="toast-container fixed top-5 end-5"></div>

<div aria-hidden="true" aria-labelledby="detailsModalLabel" class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalTitle">Details</h5>
                <button aria-label="Close" class="btn-close closeModalBtn" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body text-black" id="detailsModalBody">
            </div>
            <div class="modal-footer">
                <button aria-label="Close" class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" aria-labelledby="editItemModalLabel" class="modal fade" id="editItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editItemModalTitle">Edit Item</h5>
                <button aria-label="Close" class="btn-close closeModalBtn" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body" id="editItemModalBody">
            </div>
            <div class="modal-footer">
                <button aria-label="Close" class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-success" id="saveEditBtn" type="button">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<div aria-hidden="true" aria-labelledby="exportModalLabel" class="modal fade" id="exportModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportModalTitle">Export Data</h5>
                <button aria-label="Close" class="btn-close closeModalBtn" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <p>Your planner data has been exported successfully!</p>
                <a class="btn btn-primary" href="#" id="downloadLink">Download JSON</a>
            </div>
            <div class="modal-footer">
                <button aria-label="Close" class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })

    const newTaskBtn = document.getElementById('newTaskBtn');
    const newNoteBtn = document.getElementById('newNoteBtn');
    const newReminderBtn = document.getElementById('newReminderBtn');
    const newEventBtn = document.getElementById('newEventBtn');

    const tasksList = document.getElementById('tasksList');
    const notesList = document.getElementById('notesList');
    const remindersList = document.getElementById('remindersList');
    const eventsList = document.getElementById('eventsList');

    const searchBar = document.getElementById('searchBar');

    const taskCategoryFilter = document.getElementById('taskCategoryFilter');
    const noteCategoryFilter = document.getElementById('noteCategoryFilter');
    const reminderCategoryFilter = document.getElementById('reminderCategoryFilter');
    const eventCategoryFilter = document.getElementById('eventCategoryFilter');

    const detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));
    const detailsModalTitle = document.getElementById('detailsModalTitle');
    const detailsModalBody = document.getElementById('detailsModalBody');

    const editItemModal = new bootstrap.Modal(document.getElementById('editItemModal'));
    const editItemModalTitle = document.getElementById('editItemModalTitle');
    const editItemModalBody = document.getElementById('editItemModalBody');
    const saveEditBtn = document.getElementById('saveEditBtn');

    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importInput = document.getElementById('importInput');
    const exportModal = new bootstrap.Modal(document.getElementById('exportModal'));
    const downloadLink = document.getElementById('downloadLink');

    const calendarEl = document.getElementById('calendar');
    let calendar;

    function showToast(message, type) {
      const toastId = `toast-${Date.now()}`;
      const toastHTML = `
            <div class="toast ${type}" id="${toastId}">
                <span>${message}</span>
                <button class="close-btn">&times;</button>
            </div>
        `;
      const toastContainer = document.querySelector('.toast-container');
      toastContainer.innerHTML += toastHTML;
      const toastElement = document.getElementById(toastId);
      const closeBtn = toastElement.querySelector('.close-btn');

      setTimeout(() => {
        toastElement.style.opacity = '0';
        setTimeout(() => {
          toastElement.remove();
        }, 500);
      }, 3000);

      closeBtn.addEventListener('click', () => {
        toastElement.style.opacity = '0';
        setTimeout(() => {
          toastElement.remove();
        }, 500);
      });
    }

    let plannerData = getPlannerData();
    if (!plannerData) {
      plannerData = initializePlannerData();
      populateSampleData();
      savePlannerData();
    }
    renderPlanner();

    function savePlannerData () {
      localStorage.setItem('plannerData', JSON.stringify(plannerData));
    }

    function getPlannerData () {
      return JSON.parse(localStorage.getItem('plannerData'));
    }

    function initializePlannerData () {
      return {
        tasks: [],
        notes: [],
        reminders: [],
        events: []
      };
    }

    function generateId () {
      return '_' + Math.random().toString(36).substr(2, 9);
    }

    const sampleTasks = [
      {
        title: 'Complete Project Report',
        description: 'Finalize and submit the project report by end of the day.',
        category: 'Work'
      },
      {title: 'Buy Groceries', description: 'Milk, Bread, Eggs, and Vegetables.', category: 'Personal'},
      {title: 'Call John', description: 'Discuss the upcoming meeting details.', category: 'Urgent'},
      {title: 'Workout Session', description: 'Attend the gym for a 1-hour workout.', category: 'Personal'},
      {title: 'Client Meeting', description: 'Present the new project proposal.', category: 'Work'}
    ];

    const sampleNotes = [
      {content: 'Meeting notes: Discussed project milestones and deadlines.', category: 'Meeting'},
      {content: 'Ideas for the new marketing campaign.', category: 'Ideas'},
      {content: 'Personal thoughts: Need to improve time management.', category: 'Personal'},
      {content: 'Shopping list: Milk, Bread, Eggs, Butter.', category: 'Personal'},
      {content: 'Books to read: "Atomic Habits", "Deep Work".', category: 'Ideas'}
    ];

    const sampleReminders = [
      {message: 'Doctor\'s appointment at 3 PM.', category: 'Health'},
      {message: 'Call the plumber to fix the sink.', category: 'Home'},
      {message: 'Pick up groceries after work.', category: 'Home'},
      {message: 'Pay electricity bill by Friday.', category: 'Work'},
      {message: 'Schedule car maintenance.', category: 'Personal'}
    ];

    const sampleEvents = [
      {
        name: 'Lunch with Sarah',
        date: '2024-05-15',
        description: 'Discuss the upcoming project over lunch at Downtown Cafe.',
        category: 'Social'
      },
      {
        name: 'Yoga Class',
        date: '2024-05-16',
        description: 'Attend the evening yoga session at Sunrise Yoga Studio.',
        category: 'Personal'
      },
      {
        name: 'Webinar on AI',
        date: '2024-05-17',
        description: 'Participate in the AI advancements webinar hosted by TechWorld.',
        category: 'Work'
      },
      {
        name: 'Birthday Party',
        date: '2024-05-18',
        description: 'Celebrate John\'s birthday at his residence.',
        category: 'Social'
      },
      {
        name: 'Conference Call',
        date: '2024-05-19',
        description: 'Join the quarterly business review call with the management team.',
        category: 'Work'
      }
    ];

    function populateSampleData() {
      plannerData.tasks = sampleTasks.map(task => ({ id: generateId(), ...task }));
      plannerData.notes = sampleNotes.map(note => ({ id: generateId(), ...note }));
      plannerData.reminders = sampleReminders.map(reminder => ({ id: generateId(), ...reminder, date: new Date().toISOString() }));
      plannerData.events = sampleEvents.map(event => ({ id: generateId(), ...event }));
    }

    function renderPlanner () {
      renderTasks();
      renderNotes();
      renderReminders();
      renderEvents();
      initializeCalendar();
    }

    function renderTasks () {
      tasksList.innerHTML = '';
      const filteredTasks = filterItems(plannerData.tasks, taskCategoryFilter.value, searchBar.value, 'title');
      if (filteredTasks.length === 0) {
        tasksList.innerHTML = '<p>No tasks found.</p>';
        return;
      }
      filteredTasks.forEach(task => {
        const col = document.createElement('div');
        col.className = 'col-md-6';

        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('aria-label', `Task: ${task.title}`);

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        cardBody.innerHTML = `
                <h5 class="card-title">${task.title}</h5>
                <p class="card-text">${task.description}</p>
                <p class="card-text"><strong>Category:</strong> ${task.category}</p>
                <div class="d-flex justify-content-between">
                    <button class="btn btn-primary btn-sm" onclick="viewDetails('tasks', '${task.id}')" aria-label="View Task"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-success btn-sm" onclick="editItem('tasks', '${task.id}')" aria-label="Edit Task"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('tasks', '${task.id}')" aria-label="Delete Task"><i class="fas fa-trash"></i></button>
                </div>
            `;

        card.appendChild(cardBody);
        col.appendChild(card);
        tasksList.appendChild(col);
      });
    }

    function renderNotes () {
      notesList.innerHTML = '';
      const filteredNotes = filterItems(plannerData.notes, noteCategoryFilter.value, searchBar.value, 'content');
      if (filteredNotes.length === 0) {
        notesList.innerHTML = '<p>No notes found.</p>';
        return;
      }
      filteredNotes.forEach(note => {
        const col = document.createElement('div');
        col.className = 'col-md-6';

        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('aria-label', `Note: ${note.content.substring(0, 20)}...`);

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        cardBody.innerHTML = `
                <p class="card-text">${note.content.substring(0, 50)}...</p>
                <p class="card-text"><strong>Category:</strong> ${note.category}</p>
                <div class="d-flex justify-content-between">
                    <button class="btn btn-primary btn-sm" onclick="viewDetails('notes', '${note.id}')" aria-label="View Note"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-success btn-sm" onclick="editItem('notes', '${note.id}')" aria-label="Edit Note"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('notes', '${note.id}')" aria-label="Delete Note"><i class="fas fa-trash"></i></button>
                </div>
            `;

        card.appendChild(cardBody);
        col.appendChild(card);
        notesList.appendChild(col);
      });
    }

    function renderReminders () {
      remindersList.innerHTML = '';
      const filteredReminders = filterItems(plannerData.reminders, reminderCategoryFilter.value, searchBar.value, 'message');
      if (filteredReminders.length === 0) {
        remindersList.innerHTML = '<p>No reminders found.</p>';
        return;
      }
      filteredReminders.forEach(reminder => {
        const col = document.createElement('div');
        col.className = 'col-md-6';

        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('aria-label', `Reminder: ${reminder.message}`);

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        cardBody.innerHTML = `
                <p class="card-text">${reminder.message}</p>
                <p class="card-text"><strong>Category:</strong> ${reminder.category}</p>
                <p class="card-text"><strong>Date:</strong> ${new Date(reminder.date).toLocaleString()}</p>
                <div class="d-flex justify-content-between">
                    <button class="btn btn-primary btn-sm" onclick="viewDetails('reminders', '${reminder.id}')" aria-label="View Reminder"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-success btn-sm" onclick="editItem('reminders', '${reminder.id}')" aria-label="Edit Reminder"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('reminders', '${reminder.id}')" aria-label="Delete Reminder"><i class="fas fa-trash"></i></button>
                </div>
            `;

        card.appendChild(cardBody);
        col.appendChild(card);
        remindersList.appendChild(col);
      });
    }

    function renderEvents () {
      eventsList.innerHTML = '';
      const filteredEvents = filterItems(plannerData.events, eventCategoryFilter.value, searchBar.value, 'name');
      if (filteredEvents.length === 0) {
        eventsList.innerHTML = '<p>No events found.</p>';
        return;
      }
      filteredEvents.forEach(event => {
        const col = document.createElement('div');
        col.className = 'col-md-6';

        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('aria-label', `Event: ${event.name}`);

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        cardBody.innerHTML = `
                <h5 class="card-title">${event.name}</h5>
                <p class="card-text"><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</p>
                <p class="card-text">${event.description}</p>
                <p class="card-text"><strong>Category:</strong> ${event.category}</p>
                <div class="d-flex justify-content-between">
                    <button class="btn btn-primary btn-sm" onclick="viewDetails('events', '${event.id}')" aria-label="View Event"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-success btn-sm" onclick="editItem('events', '${event.id}')" aria-label="Edit Event"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('events', '${event.id}')" aria-label="Delete Event"><i class="fas fa-trash"></i></button>
                </div>
            `;

        card.appendChild(cardBody);
        col.appendChild(card);
        eventsList.appendChild(col);
      });
    }

    function filterItems (items, category, query, field) {
      return items.filter(item => {
        const matchCategory = category === 'all' || item.category.toLowerCase() === category.toLowerCase();
        const matchQuery = item[field].toLowerCase().includes(query.toLowerCase());
        return matchCategory && matchQuery;
      });
    }

    newTaskBtn.addEventListener('click', () => {
      addTask();
    });

    function addTask () {
      const randomTask = sampleTasks[Math.floor(Math.random() * sampleTasks.length)];
      const task = {
        id: generateId(),
        title: randomTask.title,
        description: randomTask.description,
        category: randomTask.category
      };
      plannerData.tasks.push(task);
      savePlannerData();
      renderTasks();
      showToast('Task added successfully!', 'success');
    }

    newNoteBtn.addEventListener('click', () => {
      addNote();
    });

    function addNote () {
      const randomNote = sampleNotes[Math.floor(Math.random() * sampleNotes.length)];
      const note = {
        id: generateId(),
        content: randomNote.content,
        category: randomNote.category
      };
      plannerData.notes.push(note);
      savePlannerData();
      renderNotes();
      showToast('Note added successfully!', 'success');
    }

    newReminderBtn.addEventListener('click', () => {
      addReminder();
    });

    function addReminder () {
      const randomReminder = sampleReminders[Math.floor(Math.random() * sampleReminders.length)];
      const reminder = {
        id: generateId(),
        message: randomReminder.message,
        category: randomReminder.category,
        date: new Date(Date.now() + 60000).toISOString()
      };
      plannerData.reminders.push(reminder);
      savePlannerData();
      renderReminders();
      scheduleNotification(reminder);
      showToast('Reminder added successfully!', 'success');
    }

    newEventBtn.addEventListener('click', () => {
      addEvent();
    });

    function addEvent () {
      const randomEvent = sampleEvents[Math.floor(Math.random() * sampleEvents.length)];
      const event = {
        id: generateId(),
        name: randomEvent.name,
        date: randomEvent.date,
        description: randomEvent.description,
        category: randomEvent.category
      };
      plannerData.events.push(event);
      savePlannerData();
      renderEvents();
      addEventToCalendar(event);
      showToast('Event added successfully!', 'success');
    }

    window.viewDetails = function (section, id) {
      let content = '';
      let title = '';
      if (section === 'tasks') {
        const task = plannerData.tasks.find(t => t.id === id);
        if (task) {
          content = `
                    <h4>${task.title}</h4>
                    <p>${task.description}</p>
                    <p><strong>Category:</strong> ${task.category}</p>
                `;
          title = 'Task Details';
        }
      } else if (section === 'notes') {
        const note = plannerData.notes.find(n => n.id === id);
        if (note) {
          content = `
                    <h4>Note</h4>
                    <p>${note.content}</p>
                    <p><strong>Category:</strong> ${note.category}</p>
                `;
          title = 'Note Details';
        }
      } else if (section === 'reminders') {
        const reminder = plannerData.reminders.find(r => r.id === id);
        if (reminder) {
          content = `
                    <h4>Reminder</h4>
                    <p>${reminder.message}</p>
                    <p><strong>Category:</strong> ${reminder.category}</p>
                    <p><strong>Date:</strong> ${new Date(reminder.date).toLocaleString()}</p>
                `;
          title = 'Reminder Details';
        }
      } else if (section === 'events') {
        const event = plannerData.events.find(e => e.id === id);
        if (event) {
          content = `
                    <h4>${event.name}</h4>
                    <p><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</p>
                    <p>${event.description}</p>
                    <p><strong>Category:</strong> ${event.category}</p>
                `;
          title = 'Event Details';
        }
      }

      detailsModalTitle.innerText = title;
      detailsModalBody.innerHTML = content;
      detailsModal.show();
    }

    window.editItem = function (section, id) {
      alert("Edit not yet implemented");
    };

    window.deleteItem = function (section, id) {
      if (confirm('Are you sure you want to delete this item?')) {
        if (section === 'tasks') {
          plannerData.tasks = plannerData.tasks.filter(t => t.id !== id);
          renderTasks();
        } else if (section === 'notes') {
          plannerData.notes = plannerData.notes.filter(n => n.id !== id);
          renderNotes();
        } else if (section === 'reminders') {
          plannerData.reminders = plannerData.reminders.filter(r => r.id !== id);
          renderReminders();
        } else if (section === 'events') {
          plannerData.events = plannerData.events.filter(e => e.id !== id);
          removeCalendarEvent(id);
          renderEvents();
        }
        savePlannerData();
        showToast('Item deleted successfully!', 'success');
      }
    }

    themeToggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      document.body.classList.toggle('light-theme');
      if (document.body.classList.contains('dark-theme')) {
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        themeToggleBtn.setAttribute('title', 'Switch to Light Theme');
      } else {
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        themeToggleBtn.setAttribute('title', 'Switch to Dark Theme');
      }
      const currentTheme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
      localStorage.setItem('theme', currentTheme);
    });

    function initializeTheme () {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        themeToggleBtn.setAttribute('title', 'Switch to Light Theme');
      } else {
        document.body.classList.add('light-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        themeToggleBtn.setAttribute('title', 'Switch to Dark Theme');
      }
    }

    initializeTheme();

    searchBar.addEventListener('input', () => {
      renderTasks();
      renderNotes();
      renderReminders();
      renderEvents();
    });

    exportBtn.addEventListener('click', () => {
      const dataStr = JSON.stringify(plannerData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      downloadLink.href = url;
      downloadLink.download = 'plannerData.json';
      exportModal.show();
      showToast('Data exported successfully!', 'success');
    });

    importBtn.addEventListener('click', () => {
      importInput.click();
    });

    importInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const importedData = JSON.parse(e.target.result);
          plannerData = importedData;
          savePlannerData();
          renderPlanner();
          showToast('Data imported successfully!', 'success');
        } catch (error) {
          showToast('Failed to import data. Please check the file format.', 'error');
        }
      };
      reader.readAsText(file);
    });

    function initializeCalendar() {
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 650,
        events: getCalendarEvents(),
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        eventClick: function(info) {
          const eventId = info.event.id;
          viewDetails('events', eventId);
        }
      });
      calendar.render();
    }

    function getCalendarEvents() {
      return plannerData.events.map(event => ({
        id: event.id,
        title: event.name,
        start: event.date
      }));
    }

    function addEventToCalendar(event) {
      calendar.addEvent({
        id: event.id,
        title: event.name,
        start: event.date
      });
    }

    function removeCalendarEvent(id) {
      const event = calendar.getEventById(id);
      if (event) {
        event.remove();
      }
    }

    function updateCalendarEvent(id, updatedEvent) {
      const event = calendar.getEventById(id);
      if (event) {
        event.setProp('title', updatedEvent.name);
        event.setStart(updatedEvent.date);
      }
    }

    function scheduleNotification(reminder) {
      const reminderTime = new Date(reminder.date).getTime();
      const now = new Date().getTime();
      const delay = reminderTime - now;

      if (delay > 0) {
        setTimeout(() => {
          showBrowserNotification(reminder.message);
        }, delay);
      }
    }

    function showBrowserNotification(message) {
      if (Notification.permission === 'granted') {
        new Notification('Reminder', { body: message });
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            new Notification('Reminder', { body: message });
          }
        });
      }
    }

    if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
      Notification.requestPermission();
    }
  });
</script>

</body>
</html>
