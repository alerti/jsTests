<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Movie Release Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
        }
        .calendar-widget, .movie-preview {
            margin-bottom: 20px;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .calendar-widget {
            margin-bottom: 30px;
        }
        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .movie-item {
            background-color: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .movie-item:hover {
            transform: scale(1.05);
        }
        .movie-item img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .btn-wishlist, .btn-reminder {
            width: 100%;
            margin-top: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn-wishlist:hover, .btn-reminder:hover {
            background-color: #0056b3;
        }
        #wishlist-tags {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
            gap: 10px;
        }
        .wishlist-tag {
            background-color: #eaeaea;
            color: white;
            padding: 2px 8px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            color: #000000;
        }
        .wishlist-tag .remove {
            background-color: #dc3545;
            color: white;
            border: none;
            margin-left: 10px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .alert {
            margin-top: 10px;
            display: none;
        }
        .wishlist{
            margin-top: 50px;
        }
    </style>
</head>
<body>

<div class="container">
    <h4>Upcoming Movie Releases</h4>
    <div class="alert alert-success" id="feedback-alert"></div>
    <div class="calendar-widget">
        <div>
            <h6>Movie Release Calendar</h6>
            <div id="movieCalendar"></div>
        </div>
        <div class="wishlist">
            <h5>Wishlist</h5>
            <div id="wishlist-tags"></div>
        </div>
    </div>

    <div class="movie-preview" id="movie-preview">
        <h6>Movie Preview</h6>
        <div class="movie-grid" id="movie-list"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  const TMDB_API_KEY = 'YOUR_TMDB_API_KEY';  // Replace with your TMDB API Key
  const today = new Date().toISOString().split('T')[0];
  const threeMonthsLater = new Date();
  threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);
  const futureDate = threeMonthsLater.toISOString().split('T')[0];

  const TMDB_API_URL = `https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_API_KEY}&language=en-US&region=US&release_date.gte=${today}&release_date.lte=${futureDate}&sort_by=release_date.asc`;

  let movies = [];
  let selectedMovies = [];
  const storedWishlist = JSON.parse(localStorage.getItem('wishlist')) || [];

  function fetchMovies() {
    $.getJSON(TMDB_API_URL, function (data) {
      movies = data.results;
      renderCalendar(movies);
    });
  }

  function renderCalendar(movies) {
    const movieDates = movies.map(movie => ({
      date: movie.release_date,
      title: movie.title,
      movieId: movie.id
    }));

    const today = new Date().toISOString().split('T')[0];

    flatpickr("#movieCalendar", {
      inline: true,
      minDate: today,  s
      enable: movieDates.map(movie => movie.date),
      onChange: function (selectedDates) {
        const selectedDate = selectedDates[0].toISOString().split('T')[0];
        selectedMovies = movies.filter(m => m.release_date === selectedDate);
        displayMoviesForDate(selectedMovies);
      }
    });
  }

  function displayMoviesForDate(movies) {
    const movieList = $('#movie-list');
    movieList.empty();
    if (movies.length > 0) {
      movies.forEach(movie => {
        const inWishlist = isInWishlist(movie.id) ? 'disabled' : '';
        movieList.append(`
                    <div class="movie-item">
                        <img src="https://image.tmdb.org/t/p/w500/${movie.poster_path}" alt="${movie.title}">
                        <h3>${movie.title}</h3>
                        <p>Release Date: ${movie.release_date}</p>
                        <button class="btn-wishlist" ${inWishlist} onclick="addToWishlist(${movie.id})" id="wishlist-${movie.id}">Add to Wishlist</button>
                        <button class="btn-reminder" onclick="setReminder('${movie.title}', '${movie.release_date}')">Set Reminder</button>
                    </div>
                `);
      });
    } else {
      movieList.append('<p>No movies are released on this date.</p>');
    }
  }

  function isInWishlist(movieId) {
    return storedWishlist.some(movie => movie.id === movieId);
  }

  window.addToWishlist = function (movieId) {
    const movie = selectedMovies.find(m => m.id === movieId);
    if (movie && !isInWishlist(movieId)) {
      storedWishlist.push(movie);
      localStorage.setItem('wishlist', JSON.stringify(storedWishlist));
      renderWishlistTags();
      $(`#wishlist-${movieId}`).prop('disabled', true);  // Disable button after adding to wishlist
      showFeedback(`${movie.title} has been added to your wishlist!`);
    }
  };

  function renderWishlistTags() {
    const wishlistTags = $('#wishlist-tags');
    wishlistTags.empty();
    if (storedWishlist.length === 0) {
      wishlistTags.append('<p>No movies in your wishlist.</p>');
    } else {
      storedWishlist.forEach(movie => {
        wishlistTags.append(`
                    <div class="wishlist-tag">
                        ${movie.title}
                        <button class="remove" onclick="removeFromWishlist(${movie.id})">&times;</button>
                    </div>
                `);
      });
    }
  }

  window.removeFromWishlist = function (movieId) {
    const index = storedWishlist.findIndex(movie => movie.id === movieId);
    if (index > -1) {
      storedWishlist.splice(index, 1);
      localStorage.setItem('wishlist', JSON.stringify(storedWishlist));
      renderWishlistTags();
      showFeedback(`The movie has been removed from your wishlist.`);
    }
  };

  window.setReminder = function (movieTitle, releaseDate) {
    alert(`Reminder set for ${movieTitle} on ${releaseDate}`);
    showFeedback(`Reminder set for ${movieTitle}!`);
  };

  function showFeedback(message) {
    const alertBox = $('#feedback-alert');
    alertBox.text(message).fadeIn().delay(2000).fadeOut();
  }

  renderWishlistTags();
  fetchMovies();
</script>

</body>
</html>
