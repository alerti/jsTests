<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Image Resizer and Compressor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        #uploadForm {
            margin-bottom: 20px;
        }
        .image-container {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
            width: 100%;
        }
        .image-box {
            text-align: center;
        }
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<h1>Image Resizer and Compressor</h1>

<form id="uploadForm">
    <input accept="image/*" id="imageLoader" name="imageLoader" type="file"/>
    <button onclick="handleImageUpload()" type="button">Resize & Compress</button>
</form>

<div class="image-container">
    <div class="image-box">
        <h2>Original Image</h2>
        <canvas id="originalCanvas"></canvas>
    </div>
    <div class="image-box">
        <h2>Resized & Compressed Image</h2>
        <canvas id="resizedCanvas"></canvas>
    </div>
</div>

<script>
  function handleImageUpload() {
    const imageLoader = document.getElementById('imageLoader');
    const file = imageLoader.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        const originalCanvas = document.getElementById('originalCanvas');
        originalCanvas.width = img.width;
        originalCanvas.height = img.height;
        const ctx = originalCanvas.getContext('2d');
        ctx.drawImage(img, 0, 0);

        // Resize and compress logic
        const resizedCanvas = document.getElementById('resizedCanvas');
        const maxWidth = 300; // Set your max width here
        const maxHeight = 300; // Set your max height here
        let width = img.width;
        let height = img.height;

        if (width > height) {
          if (width > maxWidth) {
            height *= maxWidth / width;
            width = maxWidth;
          }
        } else {
          if (height > maxHeight) {
            width *= maxHeight / height;
            height = maxHeight;
          }
        }

        resizedCanvas.width = width;
        resizedCanvas.height = height;
        const resizeCtx = resizedCanvas.getContext('2d');
        resizeCtx.drawImage(img, 0, 0, width, height);

        // Compress the image (example with quality reduction)
        const dataUrl = resizedCanvas.toDataURL('image/jpeg', 0.7); // 0.7 quality

        // Optionally, you can display or download this compressed image
        const resultImg = new Image();
        resultImg.src = dataUrl;
        resultImg.onload = () => {
          resizeCtx.clearRect(0, 0, width, height);
          resizeCtx.drawImage(resultImg, 0, 0, width, height);
        };
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
</script>

</body>
</html>