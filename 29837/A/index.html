<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tilting Maze Game</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #f0f0f0;
        }
        #gameCanvas {
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #joystick {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(0, 128, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #joystick-head {
            width: 40px;
            height: 40px;
            background: #007BFF;
            border-radius: 50%;
            cursor: grab;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
<div id="joystick">
    <div class="pulse" id="joystick-head"></div>
</div>
<canvas id="gameCanvas"></canvas>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.14.2/matter.min.js"></script>
<script>
  // Plan:
  // 1. Set up Matter.js for physics
  // 2. Create maze, balls, and target area
  // 3. Implement joystick control for tilting the maze
  // 4. Game logic for winning/losing
  // 5. Mode switching and reset functionality

  const { Engine, Render, World, Bodies, Body, Events } = Matter;

  const engine = Engine.create();
  const render = Render.create({
    element: document.body,
    canvas: document.getElementById('gameCanvas'),
    engine: engine,
    options: {
      width: 800,
      height: 600,
      wireframes: false,
      background: '#f0f0f0'
    }
  });

  // Game elements
  const mazeWalls = [
    // Example walls, needs actual maze design
    Bodies.rectangle(400, 0, 800, 20, { isStatic: true }),
    Bodies.rectangle(400, 600, 800, 20, { isStatic: true }),
    Bodies.rectangle(0, 300, 20, 600, { isStatic: true }),
    Bodies.rectangle(800, 300, 20, 600, { isStatic: true }),
  ];

  const balls = Array(5).fill().map(() =>
    Bodies.circle(400 + (Math.random() - 0.5) * 100, 100, 15, { restitution: 0.5 })
  );

  const targetArea = Bodies.circle(400, 400, 50, {
    isStatic: true,
    render: { fillStyle: 'rgba(0,255,0,0.3)' }
  });

  // Black holes for hard mode
  let blackHoles = [];

  // Joystick functionality
  const joystick = document.getElementById('joystick-head');
  let isDragging = false;
  let angleX = 0, angleY = 0;

  joystick.addEventListener('mousedown', () => isDragging = true);
  document.addEventListener('mousemove', (e) => {
    if (isDragging) {
      const bounds = joystick.parentElement.getBoundingClientRect();
      angleX = ((e.clientX - bounds.left - 50) / 50) * 15;
      angleY = ((e.clientY - bounds.top - 50) / 50) * 15;
      // Clamp angles
      angleX = Math.min(Math.max(angleX, -15), 15);
      angleY = Math.min(Math.max(angleY, -15), 15);
      applyTilt();
    }
  });
  document.addEventListener('mouseup', () => isDragging = false);

  function applyTilt() {
    Body.setAngle(engine.world.bodies[0], angleY * (Math.PI / 180)); // Assuming first body is the base
  }

  // Game logic
  function checkWin() {
    const inTarget = balls.every(ball =>
      Matter.Vector.magnitude(Matter.Vector.sub(ball.position, targetArea.position)) < 50);
    if (inTarget) alert('You Win! Press space to reset.');
  }

  function resetGame() {
    balls.forEach(ball => {
      Body.setPosition(ball, {x: 400 + (Math.random() - 0.5) * 100, y: 100});
      Body.setVelocity(ball, {x: 0, y: 0});
    });
    // Reset black holes or any other dynamic elements here
  }

  // Mode switching
  document.addEventListener('keypress', (e) => {
    if (e.key === 'h') {
      // Add black holes for hard mode
      blackHoles = [/* Add black hole bodies here */];
    } else if (e.key === 'e') {
      // Remove black holes for easy mode
      blackHoles.forEach(h => World.remove(engine.world, h));
      blackHoles = [];
    } else if (e.key === ' ') {
      resetGame();
    }
  });

  // Setup world
  World.add(engine.world, [...mazeWalls, targetArea, ...balls, ...blackHoles]);

  // Run the engine
  Engine.run(engine);
  Render.run(render);

  // Game loop to check conditions
  Events.on(engine, 'afterUpdate', function() {
    checkWin();
    // Check for balls falling into black holes here if in hard mode
  });
</script>
</body>
</html>